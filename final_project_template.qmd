---
title: "Final Project Template"
author: Sam Lee
output: pdf_document
---

```{=html}
<style type="text/css">
h1.title {
font-size: 40px;
text-align: center;
}
h4.author {
font-size: 40px;
text-align: center;
}
</style>
```
\newpage

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
library(GGally)
library(corrplot)
library(patchwork)
library(car)
library(ggfortify)
library(alr4)
library(glmnet)
library(robustbase)
set.seed(12022023)

seoul <- read.csv("SeoulBikeData.csv", header=F, skip=1) %>% setNames(
  c("Date", "RentedBikeCount", "Hour", "Temperature", "Humidity", "WindSpeed",
    "Visibility", "DewPointTemp", "SolarRadiation", "Rainfall", "Snowfall",
    "Seasons", "Holiday", "FunctioningDay")
) %>% as_tibble() %>%
  mutate(
    Date = dmy(Date),
    Time = ymd_h(paste(Date, Hour)),
    IsAutumn = as.numeric(Seasons == "Autumn"),
    IsSummer = as.numeric(Seasons == "Summer"),
    IsWinter = as.numeric(Seasons == "Winter"),
    IsSpring = as.numeric(Seasons == "Spring"),
    IsHoliday = as.numeric(Holiday == "Holiday"),
    IsFunctioningDay = as.numeric(FunctioningDay == "Yes"),
    Hour09 = Hour %in% 0:9,
    Hour1015 = Hour %in% 10:15,
    Hour1624 = Hour %in% 16:24,
    RentedBikeCount = log(RentedBikeCount+1)
  ) %>% arrange(Time)
```

# Abstract

Here, you will briefly summarize the entire report, including the data used, questions of interest, and relevant findings.

# 1 Problem and Motivation

In this section, you will describe the background information about the study that is necessary to understand why the data are important. In other words, why was it important to gather the data in the first place?

## 1.1 Data Description

[Seoul Bike Sharing Data](https://archive.ics.uci.edu/dataset/560/seoul+bike+sharing+demand)

Briefly state the source of your data and describe the relevant variables that **you will use** in your project. Include important details such as units for the different variables, and what the \`\`observational units" (rows in the data set) represent (e.g., individuals, countries, etc.)

## 1.2 Questions of Interest

Briefly and clearly state the two main questions that you will investigate throughout the report. These questions should be stated in scientific, and not statistical language. For example, "Is the slope of log of per capita GDP significantly different from zero?" should instead by give as "Does the log of per capita GDP have an effect on the average life expectancy of females in a given country?"

## 1.3 Regression Methods

For each question of interest listed in Section 2, describe what regression models, techniques, and tools you will use to fully answer it. These should include any plots you will use for exploratory analysis or diagnostic checks, as well as methods of inference you will use.

# 2 Analyses, Results, and Interpretation

Conduct the analysis in a logical fashion, including necessary code (and not any superfluous code) and its output. Give simple interpretations of your findings related to the questions of interest.

```{r}
seasons = unique(seoul$Seasons)
Temp = seoul[c("Time", "Temperature", "Seasons")]

season.base = "IsSpring"
season.dummies = setdiff(c("IsWinter", "IsSpring", "IsSummer", "IsAutumn"), season.base)

time.base = "Hour1624"
time.dummies = setdiff(c("Hour09", "Hour1015"), time.base)

time.bike = c()
for(h in unique(seoul$Hour)){
  factor = str_c("Hour", h)
  seoul[factor] = as.numeric(seoul$Hour == h)
  time.bike = c(time.bike, factor)
}
time.bike.base = "Hour0"
time.bike = setdiff(time.bike, time.bike.base)

seoul.factors = c("Temperature", "Humidity", "DewPointTemp",
                  "WindSpeed", "Visibility", "SolarRadiation", "Rainfall",
                  "Snowfall", time.dummies)

bike.dummies = c("IsHoliday", "IsFunctioningDay")
seoul.bike.factors = c("RentedBikeCount", "Humidity", "Temperature",
                       "WindSpeed", "Visibility", "DewPointTemp", "SolarRadiation",
                       "Rainfall", "Snowfall", bike.dummies, time.bike, season.dummies)

seoul.change = c()

for(factor in seoul.factors){
  change_factor = str_c(factor, "Change")
  seoul.change = c(seoul.change, change_factor)
  seoul[change_factor] = NA_real_
  for(s in seasons){
    seoul.subset = seoul %>% filter(Seasons == s)
    seoul[seoul$Seasons == s, change_factor] = seoul.subset[factor]-lag(seoul.subset[factor], n=1)
  }
}

seoul.interaction = c()
seoul.bike.interaction = c()

seoul.base = c(time.base)
seoul.bike.base = c(time.bike.base)

#All 2d Interaction Effects
continuous_interactions = combn(setdiff(seoul.change, 
                                        c(str_c(time.dummies, "Change"),
                                          str_c(season.dummies, "Change"),
                                          "TemperatureChange")), 2)
for(i in 1:ncol(continuous_interactions)){
  factor = paste(continuous_interactions[,i], collapse = "X")
  seoul.interaction = c(seoul.interaction, factor)
  seoul[factor] = NA_real_
  for(s in seasons){
    seoul.subset = seoul %>% filter(Seasons == s)
    seoul[seoul$Seasons == s, factor] = seoul.subset[continuous_interactions[1,i]]*
                                        seoul.subset[continuous_interactions[2,i]]
  }
}

continuous_interactions_bike = combn(setdiff(seoul.bike.factors, 
                                        c(time.bike, season.dummies,
                                          "RentedBikeCount")), 2)
for(i in 1:ncol(continuous_interactions_bike)){
  factor = paste(continuous_interactions_bike[,i], collapse = "X")
  seoul.bike.interaction = c(seoul.bike.interaction, factor)
  seoul[factor] = seoul[continuous_interactions_bike[1,i]]*
                  seoul[continuous_interactions_bike[2,i]]
}

#Time Interaction Effects
for(factor in setdiff(seoul.change, 
                      c(str_c(time.dummies, "Change"),
                        "TemperatureChange"))){
  for(time in str_c(time.dummies, "Change")){
    factor.interaction = str_c(factor, "X", time)
    seoul.interaction = c(seoul.interaction, factor.interaction)
    seoul[factor.interaction] = NA_real_
    for(s in seasons){
      seoul.subset = seoul %>% filter(Seasons == s)
      seoul[seoul$Seasons == s, factor.interaction] = seoul.subset[factor]*
                                                      seoul.subset[time]
    }
  }
}

for(factor in setdiff(seoul.bike.factors,
                        c(time.bike, season.dummies, "RentedBikeCount"))){
  for(time in time.bike){
    factor.interaction = str_c(factor, "X", time)
    seoul.bike.interaction = c(seoul.bike.interaction, factor.interaction)
    seoul[factor.interaction] = seoul[factor]*seoul[time]
  }
}

#Seasonal Interactions
for(factor in setdiff(seoul.bike.factors,
                        c(season.dummies, "RentedBikeCount"))){
  for(s in season.dummies){
    factor.interaction = str_c(factor, "X", s)
    seoul.bike.interaction = c(seoul.bike.interaction, factor.interaction)
    seoul[factor.interaction] = seoul[factor]*seoul[s]
  }
}

seoul[complete.cases(seoul[seoul.change]), ] -> seoul.temp
```

```{r message=FALSE, fig.width=8}
corrplot(cor(seoul[seoul.bike.factors]), type = "upper")
corrplot(cor(seoul.temp[seoul.change]), type="upper")

seoul.temp %>% ggplot()+
  geom_point(aes(x=Hour, y=TemperatureChange))+
  facet_grid(~Seasons)

threshold = 0
seoul %>% mutate(IsPrecip=(Rainfall+Snowfall) > threshold) %>% ggplot()+
  geom_point(aes(x=Hour, y=RentedBikeCount, color=IsPrecip))+
  facet_grid(~Seasons)

seoul.temp %>% ggplot()+
  geom_boxplot((aes(y=TemperatureChange, x=Seasons)))

seoul.temp %>% ggplot()+
  geom_point(aes(x=DewPointTempChange, y=TemperatureChange))+
  facet_grid(Hour09+Hour1015~Seasons)
```

```{r}
# create_season_models = function(factors, response, base=F){
#   factors = setdiff(factors, response)
#   if(base == T){
#     f = 0
#   } else {
#     f = paste(c(0, factors), collapse = " + ")
#   }
#   
#   models <- map(unique(seoul$Seasons), function(x){
#     lm(formula(paste(response, "~", f)), 
#        data = seoul[seoul$Seasons == x,] %>% 
#          select(all_of(c(factors, response))))
#   })
#   
#   names(models) <- str_c("seoul.lm.", unique(seoul$Seasons))
#   return(models)
# }
# 
# models.lm = create_season_models(seoul.change, "TemperatureChange")
# 
# for(model in models.lm){
#   print(summary(model))
# }

seoul.lm = lm(TemperatureChange ~ 0 + ., data=seoul.temp[seoul.change])
summary(seoul.lm)

seoul.bike.lm = lm(RentedBikeCount ~ ., data=seoul[seoul.bike.factors])
summary(seoul.bike.lm)
```

```{r message=F}
avPlots(seoul.lm)
avPlots(seoul.bike.lm)
```

```{r figsize=12}
autoplot(seoul.lm) +
  theme(aspect.ratio = 1)

autoplot(seoul.bike.lm) +
  theme(aspect.ratio = 1)
```

```{r}
show_leverage = function(model){
  cd_cont_pos <- function(leverage, level, model) {
    sqrt(level * length(coef(model)) * (1 - leverage) / leverage)
  }
  cd_cont_neg <- function(leverage, level, model) {
    -cd_cont_pos(leverage, level, model)
  }
  
  cd_threshold <- 0.5
  cd_threshold2 <- 4 / (nrow(seoul) - 2)
  x_max_val <- 0.35
  
  autoplot(model, which = 5, nrow = 1, ncol = 1) +
    theme(aspect.ratio = 1) +
    stat_function(fun = cd_cont_pos,
                  args = list(level = cd_threshold, model = model),
                  xlim = c(0, x_max_val), lty = 2, colour = "#FFACEE") +
    stat_function(fun = cd_cont_neg,
                  args = list(level = cd_threshold, model = model),
                  xlim = c(0, x_max_val), lty = 2, colour = "#FFACEE") +
    stat_function(fun = cd_cont_pos,
                  args = list(level = cd_threshold2, model = model),
                  xlim = c(0, x_max_val), lty = 2, colour = "#AFDFFF") +
    stat_function(fun = cd_cont_neg,
                  args = list(level = cd_threshold2, model = model),
                  xlim = c(0, x_max_val), lty = 2, colour = "#AFDFFF")
}

show_leverage(seoul.lm)
show_leverage(seoul.bike.lm)
```

```{r}
model.factors = setdiff(c(seoul.change, seoul.interaction), c(seoul.base, "TemperatureChange"))

seoul.x = as.matrix(seoul.temp[model.factors])
seoul.y = as.matrix(seoul.temp["TemperatureChange"])

lasso_cv <- cv.glmnet(x = seoul.x,
                      y = seoul.y, 
                      type.measure = "mse", 
                      alpha = 1)

d = coef(lasso_cv, s = "lambda.1se")[2:(length(model.factors)-1)]
lasso.factors = model.factors[which(d != 0)]
seoul.lasso = lm(TemperatureChange ~ 0 + .,
                                       seoul.temp[c("TemperatureChange",
                                       lasso.factors)])

print(summary(seoul.lasso))

singularities = c("SolarRadiationXHour1", "SolarRadiationXHour2", "SolarRadiationXHour3",
                  "SnowfallXIsFunctioningDay", "SolarRadiationXHour4",
                  "SolarRadiationXHour5", "SolarRadiationXHour20", "SolarRadiationXHour21",
                  "SolarRadiationXHour22", "SolarRadiationXHour23", "SnowfallXIsSummer",
                  "SnowfallXIsAutumn", "IsFunctioningDayXIsWinter", "IsFunctioningDayXIsSummer")
model.bike.factors = setdiff(c(seoul.bike.factors, seoul.bike.interaction), 
                             c(seoul.bike.base, "RentedBikeCount", singularities))

seoul.bike.x = as.matrix(seoul[model.bike.factors])
seoul.bike.y = as.matrix(seoul["RentedBikeCount"])

lasso_cv <- cv.glmnet(x = seoul.bike.x,
                      y = seoul.bike.y, 
                      type.measure = "mse", 
                      alpha = 1)

d = coef(lasso_cv, s = "lambda.1se")[2:(length(model.bike.factors)-1)]
lasso.bike.factors = model.bike.factors[which(d != 0)]
seoul.bike.lasso = lm(RentedBikeCount ~ .,
                                       seoul[c("RentedBikeCount",
                                       lasso.bike.factors)])

print(summary(seoul.bike.lasso))

seoul.bike.base.model = lm(RentedBikeCount ~ 1, seoul[c("RentedBikeCount", model.bike.factors)])
seoul.bike.full.model = lm(RentedBikeCount ~ ., seoul[c("RentedBikeCount", model.bike.factors)])

seoul.bike.step = step(seoul.bike.base.model,
                       direction = "both",
                       k = log(nrow(seoul)),
                       scope = list(lower=seoul.bike.base.model,
                                    upper=seoul.bike.full.model))

print(summary(seoul.bike.step))

# seoul.base.models = create_season_models(model.factors,
#                                          "TemperatureChange",
#                                          base = T)
#   
# seoul.full.models = create_season_models(model.factors,
#                                          "TemperatureChange")
# 
# 
# #Stepwise BIC
# create_season_stepwise = function(base_models, 
#                                   full_models){
#   models = list()
#   for(m in 1:length(base_models)){
#     base.model = base_models[[m]]
#     full.model = full_models[[m]]
#     season = unique(seoul$Seasons)[m]
#     
#     models[[str_c("seoul.stepwise.",season)]] <- step(base.model,
#          direction="both",
#          k = log(nrow(seoul[seoul$Seasons == season,])),
#          scope=list(lower=base.model,
#                      upper=full.model))
#   }
#   return(models)
# }
# 
# seoul.stepwise.bic.models = create_season_stepwise(seoul.base.models,
#                                                    seoul.full.models)

# for(model in seoul.stepwise.bic.models){
#   print(summary(model))
# }
  
# summary(seoul.stepwise.bic)
# length(seoul.stepwise.bic$coefficients)
# 
# seoul$step.residuals = seoul.stepwise.bic$residuals
#
# create_lasso = function(){
#   models = list()
#   seasons = seoul$Seasons %>% unique()
#   for(s in seasons){
#     #print(s)
#     seoul.subset = seoul %>% filter(Seasons == s)
#     seoul.x = as.matrix(seoul.subset[model.factors])
#     seoul.y = as.matrix(seoul.subset["TemperatureChange"])
#   
#     lasso_cv <- cv.glmnet(x = seoul.x,
#                           y = seoul.y, 
#                           type.measure = "mse", 
#                           alpha = 1)
#   
#     d = coef(lasso_cv, s = "lambda.1se")[2:(length(model.factors)-1)]
#     lasso.factors = model.factors[which(d != 0)]
#     models[[str_c("seoul.lasso.",s)]] = lm(TemperatureChange ~ 0 + .,
#                                            seoul.subset[c("TemperatureChange",
#                                            lasso.factors)])
#   }
#   return(models)
# }
# seoul.lasso.models = create_lasso()
# for(model in seoul.lasso.models){
#   print(summary(model))
# }


```

```{r}
epsilon = 0.5
t = seoul %>% filter(abs(RainfallChange) >= epsilon) %>% mutate(
  RainfallChange = RainfallChange + abs(min(RainfallChange)) + 1,
  TemperatureChange = TemperatureChange #+ abs(min(TemperatureChange)) + 1
)

t %>% ggplot()+
  geom_point(aes(x=RainfallChange, y=TemperatureChange))

# t$Rainfall = t$Rainfall^1.5
invTranPlot(TemperatureChange ~ RainfallChange, data=t, lambda = c(-1, -0.5, 0, 0.5, 1), optimal=T)
bc = boxCox(t$TemperatureChange ~ t$Rainfall)
lambda = bc$x[which(bc$y == max(bc$y))]
lambda
t$TemperatureChange = t$TemperatureChange^2

invTranPlot(TemperatureChange ~ RainfallChange, data=t, lambda = c(-1, -0.5, 0, 0.5, 1), optimal=T)

t %>% ggplot()+
  geom_point(aes(x=RainfallChange, y=TemperatureChange))

invTranPlot(TemperatureChange ~ Rainfall, data=t, lambda = c(-1, -0.5, 0, 0.5, 1), optimal=T)

t = seoul %>% mutate(
    SnowfallChange = SnowfallChange + abs(min(SnowfallChange)) + 1,
    TemperatureChange = TemperatureChange + abs(min(TemperatureChange)) + 1
)
invTranPlot(TemperatureChange ~ SnowfallChange, data=t, lambda = c(-1, -0.5, 0, 0.5, 1), optimal=T)

seoul %>% ggplot()+
  geom_point(aes(x=SnowfallChange, y=TemperatureChange))

snowfall.lm = lm(TemperatureChange ~ Snowfall, data=t)
summary(snowfall.lm)

seoul %>% mutate(
  Snowfall = ifelse(
    Snowfall == 0, 0,
    predict(snowfall.lm, seoul)
  )
)

seoul %>% mutate(
  IsRainDifference = abs(RainfallChange) >= epsilon,
  IsSnowing = ifelse(
    Snowfall == 0, 0,
    predict(snowfall.lm, seoul)
  )
)
```

```{r}
# for(effect in weather_effects){
#   for(hour in hours){
#     factor = str_c(effect, "X", hour)
#     seoul.factors = c(seoul.factors, factor)
#     seoul[factor] = seoul[effect]*seoul[hour]
#     seoul.interaction = c(seoul.interaction, factor)
#   }
# }
```

```{r}
# seoul.interaction.lm = lm(TemperatureChange ~ ., seoul[setdiff(seoul.factors, seoul.base)])
# seoul$interaction.residuals = seoul.interaction.lm$residuals
# summary(seoul.interaction.lm)
```

```{r}
# resid_vs_hour09 <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Hour09, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_hour1015 <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Hour1015, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_humidity <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Humidity, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_windspeed <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = WindSpeed, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_visibility <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Visibility, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_solarradiation <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = SolarRadiation, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_rainfall <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Rainfall, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_snowfall <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Snowfall, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_issummer <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = IsSummer, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_iswinter <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = IsWinter, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_isspring <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = IsSpring, y = interaction.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_hour09
# resid_vs_hour1015
# resid_vs_humidity
# resid_vs_windspeed
# resid_vs_visibility
# resid_vs_solarradiation
# resid_vs_rainfall
# resid_vs_snowfall
# resid_vs_issummer
# resid_vs_iswinter
# resid_vs_isspring
```

```{r}
# resid_vs_hour09 <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Hour09, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_hour1015 <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Hour1015, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_humidity <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Humidity, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_windspeed <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = WindSpeed, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_solarradiation <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = SolarRadiation, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_rainfall <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Rainfall, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_snowfall <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = Snowfall, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_issummer <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = IsSummer, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_iswinter <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = IsWinter, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_isspring <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = IsSpring, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# ### Interaction Effects
# 
# resid_vs_sxh10 <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = SolarXHour1015, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_sxs <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = SolarXIsSummer, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_sxh09 <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = SolarXHour09, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_hxh09 <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = HumidityXHour09, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_sxw <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = SolarXIsWinter, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# resid_vs_sxsp <- ggplot(data = seoul) +
#   geom_point(mapping = aes(x = SolarXIsSpring, y = step.residuals)) +
#   theme(aspect.ratio = 1)
# 
# 
# resid_vs_hour09
# resid_vs_hour1015
# resid_vs_humidity
# resid_vs_windspeed
# resid_vs_solarradiation
# resid_vs_rainfall
# resid_vs_snowfall
# resid_vs_issummer
# resid_vs_iswinter
# resid_vs_isspring
# 
# resid_vs_sxh09
# resid_vs_sxh10
# resid_vs_sxs
# resid_vs_sxsp
# resid_vs_sxw
# resid_vs_hxh09
```

```{r}
# for(m in 1:length(seoul.lasso.models)){
#   model = models[[m]] 
#   plot = autoplot(model) +
#     ggtitle(unique(seoul$Seasons)[m]) +
#     theme(aspect.ratio = 1)
#   print(plot)
# }

autoplot(seoul.lasso)
autoplot(seoul.bike.lasso)
```

```{r}
show_leverage(seoul.lasso)
show_leverage(seoul.bike.lasso)
```

```{r}

```

# 3 Conclusions

<!-- $\Delta \text{Temperature}_t = \beta_0 + \beta_1I(0\leq\text{Hour}_t<10) + \beta_2I(10\leq\text{Hour}_t<16) + \beta_3\text{Humidity}_t + \beta_4\text{WindSpeed}_t + \beta_5\text{Visibility}_t + \beta_6\text{SolarRadiation}_t + \beta_7\text{Snowfall}_t +\beta_8I(\text{Season}_t = \text{Winter}) + \beta_9I(\text{Season}_t = \text{Summer}) + \beta_{10}\text{SolarRadiation}_tI(\text{Season}_t = \text{Spring}) + \beta_{11}\text{SolarRadiation}_tI(\text{Season}_t = \text{Winter}) + \beta_{12}\text{SolarRadiation}_tI(\text{Season}_t = \text{Summer}) + \beta_{13}\text{SolarRadiation}_tI(0\leq\text{Hour}_t<10) + \beta_{14}\text{WindSpeed}_tI(0\leq\text{Hour}_t<10) + \beta_{15}\text{WindSpeed}_tI(10\leq\text{Hour}_t<15) + \beta_{16}\text{Visibility}_tI(0\leq\text{Hour}_t<10) + \beta{17}\text{Rainfall}_tI(0\leq\text{Hour}_t<10) + \beta{18}\text{Rainfall}_tI(11\leq\text{Hour}_t<16) + \beta{19}\text{Snowfall}_tI(0\leq\text{Hour}_t<10) + \epsilon_i$ -->

$\epsilon_i \overset{iid}{\sim} N(0, \sigma^2)$

Give additional context to you results and interpretations from Section 5 with respect to the data set and its purpose. Describe any potential weaknesses in your analysis, and how they may affect the reliability of the results.

```{r fig.width=12}
seoul.temp$PredictedTemperatureChange = predict(seoul.lasso, seoul.temp)
seoul.temp$PredictedTemperature = NA_real_

for(s in seasons){
  temp = Temp %>% filter(Seasons == s) %>% pull(Temperature) %>%
    lag(n=1)
  temp = temp[!is.na(temp)]
  seoul.temp[seoul.temp$Seasons == s,]$PredictedTemperature =
    seoul.temp[seoul.temp$Seasons == s,]$PredictedTemperatureChange +
    temp
}

seoul.temp %>%
  ggplot()+
  geom_line(aes(x=Time, y=TemperatureChange, color="Actual"), alpha=1)+
  geom_line(aes(x=Time, y=PredictedTemperatureChange,
                color="Predicted"), alpha=0.6)+
  labs(title="Predicted Temperature Change in Seoul Over Time",
       color=NULL)+
  xlab("Time")+
  ylab(expression(Delta~Temperature))

seoul.temp %>%
  ggplot()+
  geom_line(aes(x=Time, y=Temperature, color="Actual"), alpha=1)+
  geom_line(aes(x=Time, y=PredictedTemperature,
                color="Predicted"), alpha=0.6)+
  labs(title="Predicted Temperature in Seoul Over Time",
       color=NULL)+
  xlab("Time")+
  ylab(expression(Temperature))

```

```{r message=F, warning=F}
seoul$PredictedRentedBikeCount = predict(seoul.bike.step, seoul)
seoul$residual = seoul$PredictedRentedBikeCount - seoul$RentedBikeCount

seoul %>% 
  ggplot()+
  geom_point(aes(x=Time, y=exp(RentedBikeCount)-1, color="Actual"), alpha=1)+
  geom_point(aes(x=Time, y=exp(PredictedRentedBikeCount)-1,
                color="Predicted"), alpha=0.3)+
  facet_grid(~factor(seoul$Seasons, levels=c("Winter", "Spring", "Summer", "Autumn")), scales="free_x")+
  labs(title="Predicted Bike Demand in Seoul Over Time",
       color=NULL)+
  xlab("Time")+
  ylab("Rented Bike Count")+
  theme(axis.text.x = element_text(angle = 45, hjust = 0, vjust = 0))
```

# 4 Contributions

For each member of the group, write a short paragraph describing their contribution to this project and the report. It is up to you to decide how to divide up the work, so long as everyone is contributing approximately equally.

## APPENDIX

If there are any analyses, such as exploratory plots/summaries or work you did to determine appropriate transformations, or any relevant material that does not belong in one of the sections above, these can go in the Appendix. If you don't have any material like this, you can remove this section.
